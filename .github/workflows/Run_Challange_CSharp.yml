name: ğŸ” Test geÃ¤nderte C# Challenges

on:
  pull_request:
    paths:
      - 'challenges/**'

jobs:
  test-csharp-solutions:
    name: ğŸ§ª Teste C# Challenges mit solution.cs
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¦ Repository auschecken
        uses: actions/checkout@v3

      - name: ğŸ› ï¸ Setup .NET SDK
        uses: actions/setup-dotnet@v3
        with:
          dotnet-version: '8.0.x'

      - name: ğŸ” Finde geÃ¤nderte C#-Challenges
        id: find-csharp
        run: |
          echo "ğŸ“ Untersuche geÃ¤nderte Dateien..."
          CHANGED_DIRS=$(git diff --name-only ${{ github.event.before }} ${{ github.sha }} \
            | grep '^challenges/' \
            | cut -d/ -f2 \
            | sort -u)

          echo "âœ… GeÃ¤nderte Challenge-Verzeichnisse:"
          echo "$CHANGED_DIRS"

          CSHARP_DIRS=""
          for DIR in $CHANGED_DIRS; do
            if [ -f "challenges/$DIR/solution.cs" ] && [ -f "challenges/$DIR/$DIR.csproj" ]; then
              CSHARP_DIRS="$CSHARP_DIRS challenges/$DIR"
            fi
          done

          echo "csharp_dirs=$CSHARP_DIRS" >> $GITHUB_OUTPUT

      - name: ğŸ§ª Baue & teste alle betroffenen Challenges
        run: |
          for DIR in ${{ steps.find-csharp.outputs.csharp_dirs }}; do
            echo "ğŸ”§ Bearbeite: $DIR"

            echo "â¡ï¸ Ersetze starter.cs durch solution.cs fÃ¼r Test"
            if [ -f "$DIR/starter.cs" ]; then
              mv "$DIR/starter.cs" "$DIR/starter.bak.cs"
            fi
            cp "$DIR/solution.cs" "$DIR/starter.cs"

            echo "ğŸ“¦ Baue Projekt: $DIR"
            dotnet build "$DIR/*.csproj" --configuration Release

            echo "ğŸ§ª Starte Tests via TestRunner:"
            dotnet run --project "$DIR/*.csproj" || exit 1

            echo "âœ… Tests bestanden fÃ¼r $DIR"

            # Optional: Starter zurÃ¼cksetzen
            if [ -f "$DIR/starter.bak.cs" ]; then
              mv "$DIR/starter.bak.cs" "$DIR/starter.cs"
            fi
          done
