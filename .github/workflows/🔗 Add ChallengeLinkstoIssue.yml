# .github/workflows/challenge-error-automation.yml
name: Challenge Error Issue Automation

on:
  issues:
    types: [opened, labeled]

jobs:
  add-challenge-links:
    runs-on: ubuntu-latest
    if: contains(github.event.issue.labels.*.name, 'challenge-error')
    
    steps:
      - name: Add Challenge Links
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            // Challenge ID aus Issue-Titel oder Body extrahieren
            const issueBody = context.payload.issue.body || '';
            const issueTitle = context.payload.issue.title || '';
            
            // Pattern zum Finden der Challenge ID
            const challengeIdMatch = issueBody.match(/Challenge.*ID.*[:\s]+([a-zA-Z0-9\-_]+)/i) ||
                                   issueTitle.match(/Challenge.*[:\s]+([^(]+)/i);
            
            let challengeId = null;
            if (challengeIdMatch) {
              challengeId = challengeIdMatch[1].trim();
              console.log(`Found Challenge ID: ${challengeId}`);
            } else {
              console.log('No Challenge ID found in issue');
              return;
            }
            
            // Links generieren
            const githubChallengeUrl = `https://github.com/${context.repo.owner}/${context.repo.repo}/tree/main/challenges/${challengeId}`;
            const vscodeExtensionUrl = `vscode://Jodo.coding-challenges/loadChallenge?challengeId=${challengeId}`;
            
            // Kommentar mit Links erstellen
            const comment = `## üîó Challenge Links
            
**üìÅ Challenge im Repository:**  
[${challengeId} auf GitHub ansehen](${githubChallengeUrl})

**üöÄ In VS Code Extension √∂ffnen:**  
[Challenge in VS Code laden](${vscodeExtensionUrl})

---

*Diese Links wurden automatisch hinzugef√ºgt durch GitHub Actions*`;
            
            // Kommentar zum Issue hinzuf√ºgen
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.payload.issue.number,
              body: comment
            });
            
            console.log(`Added challenge links for ${challengeId} to issue #${context.payload.issue.number}`);
